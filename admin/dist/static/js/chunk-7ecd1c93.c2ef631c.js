(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7ecd1c93"],{"127f":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n("1da1"),a=(n("96cf"),n("9b15"));function o(e,t){return s.apply(this,arguments)}function s(){return s=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=new a({accessKeyId:n.accessKeyId,accessKeySecret:n.accessKeySecret,stsToken:n.stsToken,region:n.region,bucket:n.bucket}),e.next=3,r.put(n.filepath,t);case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}},4231:function(e,t,n){e.exports=n.p+"static/img/nothing.6a67b59e.png"},"7db0":function(e,t,n){"use strict";var r=n("23e7"),a=n("b727").find,o=n("44d2"),s=n("ae40"),i="find",c=!0,u=s(i);i in[]&&Array(1)[i]((function(){c=!1})),r({target:"Array",proto:!0,forced:c||!u},{find:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),o(i)},8813:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-button",{attrs:{type:"primary"},on:{click:e.handleAddGoods}},[e._v("添加货架商品")]),n("el-button",{attrs:{type:"primary",icon:"el-icon-refresh"},on:{click:e.onSyncShelves}},[e._v("推送商品")]),n("el-button",{attrs:{type:"warning"},on:{click:e.exportGoodsList}},[e._v("导出")]),n("el-table",{staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.goodsList,border:""}},[n("el-table-column",{attrs:{align:"center",label:"商品ID",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.gid)+" ")]}}])}),n("el-table-column",{attrs:{align:"center",label:"商品编号",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.code+t.row.gid)+" ")]}}])}),n("el-table-column",{attrs:{align:"center",width:"200","show-overflow-tooltip":!0,label:"商品名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.name)+" ")]}}])}),n("el-table-column",{attrs:{align:"center",label:"商品类别",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._getCategoryName(t.row.cid))+" ")]}}])}),n("el-table-column",{attrs:{align:"center",label:"价格",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s((t.row.price/100).toFixed(2))+" ")]}}])}),n("el-table-column",{attrs:{align:"center","show-overflow-tooltip":!0,label:"商品简介"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.description)+" ")]}}])}),n("el-table-column",{attrs:{align:"center",label:"数量",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.count)+" ")]}}])}),n("el-table-column",{attrs:{align:"center",width:"80",label:"商品图片"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("img",{staticClass:"goods-img",attrs:{src:e._getFirstImg(t.row.img),alt:""}})]}}])}),n("el-table-column",{attrs:{label:"状态",align:"center","class-name":"status-col",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[n("el-tag",{attrs:{type:e._f("stateFilter")(r.state)}},[e._v(" "+e._s(e._getStateStr(r.state))+" ")])]}}])}),n("el-table-column",{attrs:{align:"center",label:"操作",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(n){return e.handleEdit(t)}}},[e._v("修改")]),0!=t.row.state?n("el-button",{attrs:{size:"small"},on:{click:function(n){return e.handleModifyState(t.row,"hidden")}}},[e._v(" 隐藏 ")]):e._e(),0==t.row.state?n("el-button",{attrs:{size:"small",type:"success"},on:{click:function(n){return e.handleModifyState(t.row,"show")}}},[e._v(" 显示 ")]):e._e(),n("el-tooltip",{attrs:{content:"用户列表可见,显示为 “下架” 状态",placement:"top"}},[2!=t.row.state?n("el-button",{attrs:{size:"small"},on:{click:function(n){return e.handleModifyState(t.row,"offline")}}},[e._v(" 下架 ")]):e._e()],1),2==t.row.state?n("el-button",{attrs:{size:"small"},on:{click:function(n){return e.handleModifyState(t.row,"online")}}},[e._v(" 上架 ")]):e._e(),n("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(n){return e.handleDelete(t)}}},[e._v("删除")])]}}])})],1),n("el-dialog",{attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,title:"edit"===e.dialogType?"修改货架商品":"新增货架商品"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.submitBtnLock,expression:"submitBtnLock"}],attrs:{model:e.singleGoods,"label-width":"110px","label-position":"left"}},[n("el-form-item",{attrs:{label:"商品名称"}},[n("el-input",{attrs:{placeholder:"商品名称"},model:{value:e.singleGoods.name,callback:function(t){e.$set(e.singleGoods,"name",t)},expression:"singleGoods.name"}})],1),n("el-form-item",{attrs:{label:"商品分类"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.singleGoods.cid,callback:function(t){e.$set(e.singleGoods,"cid",t)},expression:"singleGoods.cid"}},e._l(e.categories,(function(e){return n("el-option",{key:e.cid,attrs:{label:e.name,value:e.cid}})})),1)],1),n("el-form-item",{attrs:{label:"商品价格(元)"}},[n("el-input-number",{attrs:{precision:2,max:1e8,min:0,step:100,placeholder:"商品价格"},model:{value:e.singleGoods.price,callback:function(t){e.$set(e.singleGoods,"price",t)},expression:"singleGoods.price"}})],1),n("el-form-item",{attrs:{label:"商品数量"}},[n("el-input-number",{attrs:{max:9999,min:1,step:1,placeholder:"商品数量"},model:{value:e.singleGoods.count,callback:function(t){e.$set(e.singleGoods,"count",t)},expression:"singleGoods.count"}})],1),n("el-form-item",{attrs:{label:"商品简介"}},[n("el-input",{attrs:{placeholder:"商品简介"},model:{value:e.singleGoods.summary,callback:function(t){e.$set(e.singleGoods,"summary",t)},expression:"singleGoods.summary"}})],1),n("el-form-item",{attrs:{label:"商品详情"}},[n("el-input",{attrs:{autosize:{minRows:6,maxRows:10},type:"textarea",placeholder:"商品详情"},model:{value:e.singleGoods.description,callback:function(t){e.$set(e.singleGoods,"description",t)},expression:"singleGoods.description"}})],1),n("el-form-item",{attrs:{label:"商品图片"}},[n("div",{staticClass:"img-list"},e._l(e.editImageArr,(function(t,r){return n("div",{directives:[{name:"show",rawName:"v-show",value:!t.delete,expression:"!item.delete"}],key:r},[n("img",{attrs:{src:t.url,alt:""}}),n("div",{staticClass:"mask"},[n("div",[n("i",{staticClass:"el-icon-delete",on:{click:function(n){return e.removeExitImage(t)}}})])])])})),0),n("el-upload",{ref:"uploader",attrs:{"list-type":"picture",action:"web/oss/getAuth","auto-upload":!1,"http-request":e.handleSelectSuccess,"on-change":e.imgChange,"before-upload":e.beforeImgUpload,"on-remove":e.imgChange}},[n("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择图片")])],1)],1),n("el-form-item",{attrs:{label:"商品状态"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.singleGoods.state,callback:function(t){e.$set(e.singleGoods,"state",t)},expression:"singleGoods.state"}},e._l(e.stateMapList,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),n("div",{staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{type:"danger",disabled:e.submitBtnLock},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),n("el-button",{attrs:{type:"primary",disabled:e.submitBtnLock},on:{click:e.confirmGoods}},[e._v("确认")])],1)],1),n("el-pagination",{staticClass:"pagination",attrs:{layout:"total, sizes, prev, pager, next, jumper",background:"","page-size":e.page.page_size,"pager-count":11,total:e.page.total_count},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},a=[],o=n("5530"),s=n("1da1"),i=(n("d81d"),n("4de4"),n("d3b7"),n("e9c4"),n("a434"),n("99af"),n("b0c0"),n("7db0"),n("159b"),n("96cf"),n("2ef0")),c=n.n(i),u=n("b775");function l(e){return Object(u["a"])({url:"/admin/goods/getGoods",method:"post",data:e})}function d(e){return Object(u["a"])({url:"/admin/goods/add",method:"post",data:e})}function g(e){return Object(u["a"])({url:"/admin/goods/update",method:"post",data:e})}function p(e){return Object(u["a"])({url:"/admin/goods/delete",method:"post",data:e})}function m(e){return Object(u["a"])({url:"/admin/oss/getAuth",method:"post",data:e})}function f(e){return Object(u["a"])({url:"/admin/category/getCategory",method:"post",data:e})}function b(e){return Object(u["a"])({url:"/admin/goods/exportGoods",method:"post",data:e})}var h=n("127f"),v=n("dd81"),w=n("ec26"),y={gid:0,cid:0,name:"",summary:"",description:"",price:0,count:0,img:"[]",belong:0,state:1},k={filters:{stateFilter:function(e){return 0==e?"warning":1==e?"success":2==e?"danger":"info"}},data:function(){return{submitBtnLock:!1,categories:[],goodsList:[],singleGoods:Object.assign({},y),dialogVisible:!1,dialogType:"new",ossAuth:{authType:"admin"},page:{page_index:0,page_size:10,total_count:0},stateMapList:[{id:0,name:"隐藏"},{id:1,name:"上架"},{id:2,name:"下架"}],editImageArr:[]}},components:{},computed:{},created:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getCategories();case 2:e.getGoods();case 3:case"end":return t.stop()}}),t)})))()},methods:{getCategories:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,f();case 2:n=t.sent,e.categories=n.data;case 4:case"end":return t.stop()}}),t)})))()},onSyncShelves:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(v["e"])();case 2:n=t.sent,e.$message({message:n.msg,type:n.res_code>0?"success":"error"});case 4:case"end":return t.stop()}}),t)})))()},getGoods:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=Object(o["a"])(Object(o["a"])({},e.page),{},{gid:0,name:"",state:-2}),t.next=3,l(n);case 3:r=t.sent,e.goodsList=r.data.list,e.page.page_index=r.data.page_index,e.page.page_size=r.data.page_size,e.page.total_count=r.data.total_count;case 8:case"end":return t.stop()}}),t)})))()},exportGoodsList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=Object(o["a"])(Object(o["a"])({},e.page),{},{gid:0,name:"",state:-2}),t.next=3,b(n);case 3:r=t.sent,window.open(window.location.origin+window.location.pathname+r.data.substr(1,r.data.length),"_blank");case 5:case"end":return t.stop()}}),t)})))()},handleAddGoods:function(){this.singleGoods=Object.assign({},y),this.dialogType="new",this.editImageArr=[],this.dialogVisible=!0,this.submitBtnLock=!1},handleEdit:function(e){this.dialogType="edit",this.singleGoods=c.a.cloneDeep(e.row),this.editImageArr=JSON.parse(this.singleGoods.img).map((function(e){return{guid:Object(w["a"])(),uid:0,url:e,state:1,delete:!1}})),this.singleGoods.price/=100,this.dialogVisible=!0,this.submitBtnLock=!1},confirmGoods:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,r,a,i,u,l,p,f,b;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.submitBtnLock=!0,n="edit"===e.dialogType,r=c.a.cloneDeep(e.singleGoods),r.price=parseInt(100*r.price),a=e,!r.waitUpload){t.next=15;break}i=function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,m({authType:"goods-shelves"});case 2:return n=e.sent,r=n.data,e.next=6,Object(h["a"])(t.raw,r);case 6:o=e.sent,console.log(o),a.editImageArr.push({guid:0,uid:t.uid,url:o.url,newadd:!0});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=0;case 8:if(!(u<r.waitUpload.length)){t.next=14;break}return t.next=11,i(r.waitUpload[u]);case 11:u++,t.next=8;break;case 14:e.$refs.uploader.clearFiles();case 15:if(r.img=e.editImageArr.filter((function(e){return 0==e.uid&&!e.delete||e.uid>0})).map((function(e){return e.url})),r.img=JSON.stringify(r.img),!n){t.next=32;break}return t.next=20,g(Object(o["a"])(Object(o["a"])({},r),{},{fileChnage:e.editImageArr}));case 20:e.editImageArr=[],r.waitUpload=void 0,l=0;case 23:if(!(l<e.goodsList.length)){t.next=30;break}if(e.goodsList[l].gid!==r.gid){t.next=27;break}return e.goodsList.splice(l,1,Object.assign({},r)),t.abrupt("break",30);case 27:l++,t.next=23;break;case 30:t.next=44;break;case 32:return t.next=34,d(r);case 34:if(p=t.sent,f=p.res_code,b=p.data,e.editImageArr=[],!(f<1)){t.next=41;break}return e.submitBtnLock=!1,t.abrupt("return");case 41:r.waitUpload=void 0,r.gid=b,e.goodsList.unshift(r);case 44:e.dialogVisible=!1,e.submitBtnLock=!1,r.updateInfo=void 0,e.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"\n                    <div>商品id: ".concat(r.gid,"</div>\n                    <div>商品名称: ").concat(r.name,"</div>\n                "),type:"success"});case 48:case"end":return t.stop()}}),t)})))()},handleModifyState:function(e,t){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=c.a.cloneDeep(e),"hidden"==t?a.state=0:"show"==t?a.state=1:"offline"==t?a.state=2:"online"==t&&(a.state=1),r.next=4,g(a);case 4:o=0;case 5:if(!(o<n.goodsList.length)){r.next=12;break}if(n.goodsList[o].gid!==a.gid){r.next=9;break}return n.goodsList.splice(o,1,Object.assign({},a)),r.abrupt("break",12);case 9:o++,r.next=5;break;case 12:n.$message({message:"操作成功",type:"success"}),e.state=a.state;case 14:case"end":return r.stop()}}),r)})))()},handleDelete:function(e){var t=this,n=e.$index,r=e.row;this.$confirm("确定删除当前商品?不可恢复！！！如仍需使用建议使用 “不显示” 功能","警告",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p({gid:r.gid});case 2:t.goodsList.splice(n,1),t.$message({type:"success",message:"删除成功!"});case 4:case"end":return e.stop()}}),e)})))).catch((function(e){console.error(e)}))},handleSelectSuccess:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a,o,s,i,c,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log("--- ---"),console.log(e),r.abrupt("return");case 5:return a=r.sent,o=a.data,s=t,i=n("9b15"),console.log(o),c=new i({accessKeyId:o.accessKeyId,accessKeySecret:o.accessKeySecret,stsToken:o.stsToken,region:o.region,bucket:o.bucket}),r.next=13,c.put(o.filepath,e.file);case 13:u=r.sent,console.log("-- result"),console.log(u),u.res&&200==u.res.status?(s.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:"上传完成",type:"success"}),s.singleGoods.img=u.url):(s.$notify({title:"上传失败",dangerouslyUseHTMLString:!0,message:"",type:"error"}),console.log("--- upload err ---"),console.log(u));case 17:case"end":return r.stop()}}),r)})))()},beforeImgUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type,n=e.size/1024/1024<20;return t||this.$message.error("上传头像图片只能是 JPG 或 PNG 格式!"),n||this.$message.error("上传头像图片大小不能超过 20MB!"),t&&n},_getFirstImg:function(e){var t=JSON.parse(e);return t.length>0?t[0]:n("4231")},_getAllImg:function(e){return JSON.parse(e)},_getStateStr:function(e){return 0==e?"隐藏":1==e?"正常":2==e?"下架":"未知"},_getCategoryName:function(e){var t=this.categories.find((function(t){return t.cid==e}));return t?t.name:""},imgChange:function(e,t){this.singleGoods.waitUpload=t},removeExitImage:function(e){this.editImageArr&&this.editImageArr.forEach((function(t){t.guid==e.guid&&(t.delete=!0)}))},handleSizeChange:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.page.page_size=e,n.next=3,t.getGoods();case 3:case"end":return n.stop()}}),n)})))()},handleCurrentChange:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.page.page_index=e-1,n.next=3,t.getGoods();case 3:case"end":return n.stop()}}),n)})))()}}},x=k,_=(n("e0cc"),n("2877")),S=Object(_["a"])(x,r,a,!1,null,"692cc23a",null);t["default"]=S.exports},dcb5:function(e,t,n){},dd81:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return c}));var r=n("b775");function a(e){return Object(r["a"])({url:"/admin/sync/syncRush",method:"post",data:e})}function o(e){return Object(r["a"])({url:"/admin/sync/syncShelves",method:"post",data:e})}function s(e){return Object(r["a"])({url:"/admin/sync/celarAllUserBlackList",method:"post",data:e})}function i(e){return Object(r["a"])({url:"/admin/sync/clearAllUserPrivilege",method:"post",data:e})}function c(e){return Object(r["a"])({url:"/admin/sync/syncCommon",method:"post",data:e})}},e0cc:function(e,t,n){"use strict";n("dcb5")},e9c4:function(e,t,n){var r=n("23e7"),a=n("d066"),o=n("d039"),s=a("JSON","stringify"),i=/[\uD800-\uDFFF]/g,c=/^[\uD800-\uDBFF]$/,u=/^[\uDC00-\uDFFF]$/,l=function(e,t,n){var r=n.charAt(t-1),a=n.charAt(t+1);return c.test(e)&&!u.test(a)||u.test(e)&&!c.test(r)?"\\u"+e.charCodeAt(0).toString(16):e},d=o((function(){return'"\\udf06\\ud834"'!==s("\udf06\ud834")||'"\\udead"'!==s("\udead")}));s&&r({target:"JSON",stat:!0,forced:d},{stringify:function(e,t,n){var r=s.apply(null,arguments);return"string"==typeof r?r.replace(i,l):r}})},ec26:function(e,t,n){"use strict";var r,a=new Uint8Array(16);function o(){if(!r&&(r="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(a)}var s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function i(e){return"string"===typeof e&&s.test(e)}for(var c=i,u=[],l=0;l<256;++l)u.push((l+256).toString(16).substr(1));function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(u[e[t+0]]+u[e[t+1]]+u[e[t+2]]+u[e[t+3]]+"-"+u[e[t+4]]+u[e[t+5]]+"-"+u[e[t+6]]+u[e[t+7]]+"-"+u[e[t+8]]+u[e[t+9]]+"-"+u[e[t+10]]+u[e[t+11]]+u[e[t+12]]+u[e[t+13]]+u[e[t+14]]+u[e[t+15]]).toLowerCase();if(!c(n))throw TypeError("Stringified UUID is invalid");return n}var g=d;function p(e,t,n){e=e||{};var r=e.random||(e.rng||o)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=r[a];return t}return g(r)}t["a"]=p}}]);